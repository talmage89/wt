## 2026-02-24T10-00-00Z

Location: ~/wt-usage-tests/2026-02-24T10-00-00/
Tests performed:
- Stash apply after branch rebase (conflict scenario): saved stash at base 7ac0cb1 (shared-file.txt = "base content"), force-updated local branch tip to fe86946 (shared-file.txt = "rebased content..."), re-checked out feature/rebase-test; wt detected conflict and printed "wt: Stash for feature/rebase-test produced conflicts. Resolve manually." (exit 0); shared-file.txt contained correct conflict markers (<<<<<<< Updated upstream / ======= / >>>>>>> Stashed changes); stash retained in stash list at status=active — correct per VISION §5.2
- Real file migration via wt sync: configured [shared] directories=[".config"], created real (non-symlink) .config/app.json in pool-wren-husk slot with content {"key":"migrated-value"}; ran wt sync; canonical file moved to .wt/shared/.config/app.json with original content preserved; pool-wren-husk slot got symlink -> ../../.wt/shared/.config/app.json; all 4 other slots also got correct symlinks — correct per VISION §6.2 "move it to .wt/shared/ and replace it with a symlink"
- Broken symlink cleanup via wt sync: deleted canonical .wt/shared/.config/app.json; verified all 5 slots had broken symlinks; ran wt sync; all 5 broken symlinks removed cleanly (no errors, no residual files) — correct per VISION §6.2 "If a symlink is broken (target deleted), remove it"
- Manual git worktree add in container: ran `git worktree add manual-slot feature/branch-a` directly in the bare repo; wt list showed only the 5 managed slots (ignored manual-slot), no errors, exit 0 — correct graceful handling; wt does not manage externally-added worktrees
Result: PASS

---

## 2026-02-24T09-00-00Z

Location: ~/wt-usage-tests/2026-02-24T09-00-00/
Tests performed:
- BUG-007 fix verified: shared symlinks excluded from stash on eviction; stash for feature/alpha contained only user files (alpha.txt, my-untracked.txt) — no .config/app.json symlink; stash applied cleanly with no "already exists, no checkout" error — correct
- BUG-008 fix verified: wt fetch archival produced clean output — "Warning: zstd not found. Archived stash stored uncompressed." and "Archived 1 stash(es): feature/zeta" with NO "fatal: this operation must be run in a work tree" — correct
- wt clean with actual archived stash: displayed archived stash list with branch, age, size; prompts for selection and confirmation correctly; actual deletion not confirmed (requires TTY for two sequential readline prompts — non-TTY piped input insufficient); stash archive file and metadata confirmed present before and after TTY-incomplete test
- wt stash drop on archived stash: prompt "Drop stash for 'feature/zeta'? This cannot be undone. [y/N]" appeared correctly; TTY required for confirmation
- Template {{BRANCH_NAME}} on vacant (detached) slots: wt sync generated slot-info.txt in all 5 slots; vacant slots (green-palm-talon, forest-bent-prism) correctly got branch= (empty string), not "undefined" or error; occupied slots got correct branch names — correct per templates.ts expandTemplate (slot.branch ?? "")
- Sequential eviction of all slots: evicted 3 occupied slots in sequence by checkout of lambda, mu, nu; first used 2 vacant slots, then evicted LRU occupied slot (feature/theta); 3 active stash metadata files accumulated correctly (feature/alpha, feature/eta, feature/theta) alongside existing archived feature/zeta; each stash contained correct user dirty state; no shared-symlink contamination in any stash
- Confirmed: wt clean prompts work interactively (correct behavior); piped input fails at second readline due to Node.js readline interface destroy/create pattern — expected TTY-only behavior, not a wt bug
Result: PASS

---

## 2026-02-23T24-00-00Z

Location: ~/wt-usage-tests/2026-02-23T24-00-00/
Tests performed:
- wt init twice (from inside already-initialized container): "Directory is not empty. Use 'wt init' from inside an existing repository, or run from an empty directory." (exit 1) — acceptable behavior
- Delete a slot directory (ember-quartz-trunk), run wt list: wt silently reconciled — recreated a new vacant slot (glade-spruce-reed) to maintain slot count of 5; "Preparing worktree" message printed (expected git output); list showed 5 slots correctly — correct graceful handling per VISION §3.2
- Corrupt state.toml (invalid TOML), run wt list: "Warning: .wt/state.toml is corrupted. Regenerating from git state." (stderr), state recovered from git, list showed correct slots with epoch timestamps (expected since real timestamps lost) — correct
- Stash archival: faked stash last_used_at to 8 days ago, deleted feature/alpha from remote, ran wt fetch; archival triggered; patch file written to .wt/stashes/archive/feature--alpha.patch; stash metadata updated to status=archived — correct. However: "fatal: this operation must be run in a work tree" printed to stderr before archival succeeded — BUG FOUND
Result: BUG FOUND
Bug: BUG-008 — archiveStash leaks `fatal: this operation must be run in a work tree` from git stash show called against bare repo (see .docs/BUGS.md)

---

## 2026-02-23T22:00:00Z

Location: ~/wt-usage-tests/2026-02-23T22-00-00/
Tests performed:
- zsh shell-init output: syntactically valid wt() function, uses `command wt "$@"` (BUG-003 fix present), reads /tmp/wt-nav-$$ (matching process.ppid in binary), post-checkout hook integration — correct
- fish shell-init output: syntactically valid fish function, uses `command wt $argv`, reads /tmp/wt-nav-$fish_pid — correct; zsh/fish not available in test env, static analysis only
- Non-existent branch checkout: `wt checkout nonexistent-branch-xyz` → git error passes through verbatim + "wt: Command failed with exit code 1" (exit 1) — correct per VISION §15.3
- git-tracked file wins over shared symlink: configured [shared] directories = [".config"], but branch feature/tracked-config has .config/app.json git-tracked; ran wt checkout feature/tracked-config; warning "wt: Skipping symlink for .config/app.json: file is tracked by git in branch feature/tracked-config." printed; slot has regular file (git content), NOT a symlink — correct per VISION §6.3
- Non-tracked slots get the symlink: ran wt sync; main slot got lrwxrwxrwx .config/app.json -> ../../.wt/shared/.config/app.json — correct
- wt clean with no archived stashes: "No archived stashes to clean." (exit 0) — correct
- wt pin from inside slot (no args): pinned correctly, "Pinned 'narrow-ardent-snipe' (branch: main). It will not be evicted." — correct
- wt unpin from inside slot (no args): unpinned correctly — correct
- wt pin from outside container (/tmp): "wt: Not inside a wt-managed container." (exit 1) — correct
- wt pin from container root (no slot arg): "wt: Not inside a worktree slot. Specify a slot name." (exit 1) — correct
- wt checkout --no-restore: slot checked out, auto-restore skipped, stash retained in stash list — correct (BUG-004 fix confirmed again)
- wt stash apply with tracked-file merge conflict AND shared-symlink collision: applied stash for feature/conflict-test (stash from old commit, branch at new commit); got both: (a) merge conflict markers in shared-file.txt, and (b) "already exists, no checkout" error for .config/app.json shared symlink — BUG FOUND
Result: BUG FOUND
Bug: BUG-007 — stash apply fails for shared symlinks because wt sync creates them before stash apply, causing "already exists, no checkout" error; shared symlinks should not be included in stashes (see .docs/BUGS.md)

---

## 2026-02-23T20:00:00Z

Location: ~/wt-usage-tests/2026-02-23T20-00-00/
Tests performed:
- wt init from URL (bare clone) into fresh directory: 5 slots created, 1 on main, 4 vacant — correct
- Post-checkout hook (.wt/hooks/post-checkout) with shell integration: created executable hook, ran `wt checkout feature/api` via eval'd shell function; hook called with correct args (worktree path = slot dir, branch = feature/api) — correct per VISION §4.3
- Post-checkout hook across multiple checkouts: verified hook fires on each checkout with slot-specific worktree path and branch name — correct
- Shared symlink conflict check (BUG-005 regression): configured [shared] directories = [".claude"], created .wt/shared/.claude/CLAUDE.md, ran wt sync — "error: pathspec '.claude/CLAUDE.md' did not match any file(s) known to git" still printed 5 times (once per slot)
- Root cause: dist/chunk-EHB43JQC.js still has `stdio: ["ignore", "pipe", "inherit"]` in isTracked; pnpm build was NOT run after the BUG-005 source fix was committed at 07:45:59
Result: BUG FOUND
Bug: BUG-006 — BUG-005 fix not applied to binary; dist not rebuilt after source change (see .docs/BUGS.md)

---

## 2026-02-23T16:00:00Z

Location: ~/wt-usage-tests/2026-02-23T16-00-00/
Tests performed:
- wt init from existing repo (no URL): repo moved to .wt/repo/, 5 slots created, 1 slot on main, 4 vacant — correct
- Slot count increase: changed slot_count from 5 to 7 in config.toml, ran wt list; 2 new vacant slots created automatically — correct
- Slot count decrease: changed slot_count from 7 to 4, ran wt list; 3 LRU slots removed (directories and git worktree entries cleaned up) — correct
- Slot count decrease below pinned count: pinned all 4 remaining slots, set slot_count=2, ran wt list → "wt: Cannot reduce slot count to 2: 4 worktrees are pinned. Unpin worktrees first or choose a higher count." (exit 1) — correct per VISION §10.1
- Checkout branch already in a slot: wt checkout main (already in slot widgeon-husk-flat) → exit 0, nav file pointed to correct slot, no eviction — correct per VISION §3.1 step 3
- Shared symlinks via wt sync: configured [shared] directories = [".claude"], created canonical files in .wt/shared/.claude/, ran wt sync; all 5 slots got correct symlinks pointing to canonical files — correct
- Shared symlinks on checkout: wt checkout feature/slot-count ran symlink reconciliation (step 9), symlinks created correctly in the target slot — correct
- BUG FOUND: wt sync and wt checkout print raw git error output "error: pathspec '.claude/CLAUDE.md' did not match any file(s) known to git" for every untracked shared file in every slot during the git-tracked conflict check
Result: BUG FOUND
Bug: BUG-005 — internal git stderr leaked during shared symlink conflict check (see .docs/BUGS.md)

---

## 2026-02-23T14:00:00Z

Location: ~/wt-usage-tests/2026-02-23T14-00-00/
Tests performed:
- Discovered: BUG-004 source fix was committed but dist/ was never rebuilt (pnpm build not run). Binary still had old `.option("no-restore")` code. Fixed by running `pnpm build` at start of session.
- --no-restore flag (BUG-004 fix verified post-rebuild): `wt checkout --no-restore feature/auth` succeeded (exit 0), worktree clean, stash preserved in `wt stash list` — correct
- wt stash apply (manual): `wt stash apply feature/auth` restored staged, unstaged, and untracked files; stash cleaned up on success; "Stash applied and cleaned up for 'feature/auth'." — correct (staged state becomes unstaged after apply, expected behavior of `git stash apply` without --index per VISION §5.2)
- wt stash apply on branch not in any slot: `wt stash apply feature/evict-trigger` (stash exists, branch evicted) → "wt: Branch 'feature/evict-trigger' is not checked out in any slot. Run 'wt checkout feature/evict-trigger' first." (exit 1) — correct
- wt stash apply with no stash: `wt stash apply feature/api` → "wt: No stash found for branch 'feature/api'." (exit 1) — correct
- wt fetch: ran wt fetch after adding upstream commit to feature/api; output showed "Fetched latest from remote." and remote tracking ref in bare repo updated to new commit — correct
- Template files via wt sync: configured [[templates]] in config.toml with source "templates/.env.development" (uses {{WORKTREE_DIR}} and {{BRANCH_NAME}}), ran `wt sync`; all 5 slots got correct .env.development with slot-specific WORKTREE_DIR and branch-specific BRANCH_NAME values — correct
- Template regeneration on wt checkout: checked out feature/evict-trigger into spit-lupine-cool; .env.development regenerated with BRANCH=feature/evict-trigger — correct
- Observation: generated template files (.env.development) are untracked, causing all slots to show as "dirty" in wt list — expected behavior per VISION §7.3 (user must gitignore generated files)
- LRU eviction correctness spot-checked: verified via state.toml timestamps that LRU selection correctly chose oldest slot
Result: PASS

---

## 2026-02-23T12:00:00Z

Location: ~/wt-usage-tests/2026-02-23T12-00-00/
Tests performed:
- BUG-003 fix verified: eval "$(wt shell-init bash)" then wt checkout — cwd changed correctly to slot directory, no segfault
- wt pin (by name) and wt unpin: pinned all 5 slots including a vacant one; verified pinned=true in wt list; unpinned one slot successfully
- All-slots-pinned error: with all 5 slots filled and pinned, wt checkout of new branch → "All worktree slots are pinned. Unpin a worktree or increase the slot count to continue." (exit 1) — correct per VISION.md §11
- LRU eviction with dirty state (staged + unstaged + untracked): all three file types saved in stash and shown in wt stash show — BUG-001 fix confirmed working
- wt stash list: shows branch, age, status (active), base commit correctly
- wt stash show: displays full diff of stash including untracked files
- wt stash drop: prompts for confirmation, deletes stash, wt stash list shows "No saved stashes"
- wt stash show on branch with no stash: "wt: No stash found for branch 'feature/api'." (exit 1) — correct
- Reconciliation: direct git checkout inside a slot (bypassing wt), then wt list silently updated state to show new branch — correct per VISION.md §3.2
- --no-restore flag: wt checkout --no-restore <branch> → "Unknown argument: restore" (exit 1) — BUG FOUND
Result: BUG FOUND
Bug: BUG-004 — `--no-restore` flag rejected by yargs strict mode due to boolean-negation conflict (see .docs/BUGS.md)

---

## 2026-02-23T09:00:00Z

Location: ~/wt-usage-tests/2026-02-23T09-00-00/
Tests performed:
- wt shell-init bash: output defines a syntactically valid wt() function (verified with `type wt`)
- wt checkout feature/slash-branch (branch with `/` in name): succeeded, slot assigned, wt list correct
- shell integration cwd change: eval'd shell function, then called `wt checkout` — bash segfaulted (exit 139)
- Root cause confirmed: `command -v wt` inside the shell function returns `wt` (the function name, not the binary path) because the shell function shadows the binary; `"$wt_bin" "$@"` thus calls the function recursively causing stack overflow
Result: BUG FOUND
Bug: BUG-003 — shell function infinite recursion → segfault because `command -v wt` returns function name instead of binary path (see .docs/BUGS.md)

---

## 2026-02-23T08:00:00Z

Location: ~/wt-usage-tests/2026-02-23T08-00-00/
Tests performed:
- wt init from local file:// URL (bare clone) — succeeded
- wt list from inside container: showed 1 active slot (main) + 4 vacant slots correctly
- Observed: "fatal: ref HEAD is not a symbolic ref" printed 4 times for vacant (detached HEAD) slots during reconciliation
- Bug confirmed: currentBranch() in reconcile uses stdio inherit for stderr, leaking internal git errors to terminal
Result: BUG FOUND
Bug: BUG-002 — "fatal: ref HEAD is not a symbolic ref" printed for every vacant slot on every wt command (see .docs/BUGS.md)

---

## 2026-02-23T07:05:00Z

Location: ~/wt-usage-tests/2026-02-23T10-00-00/
Tests performed:
- wt init from local repo URL (bare clone path)
- wt checkout of remote-only branches (feature/auth, feature/api, fix/bug-123, feature/db)
- wt list output format and slot assignment verification
- Stash save on LRU eviction: slot with staged + unstaged + untracked changes evicted
- Stash restore on branch re-checkout: verified staged/unstaged restored, untracked NOT restored
- git stash create --include-untracked confirmed to omit untracked files (2-parent only)
- git stash push --include-untracked confirmed to include untracked files (3-parent)
Result: BUG FOUND
Bug: BUG-001 — untracked files silently lost during slot eviction due to git stash create not supporting --include-untracked (see .docs/BUGS.md)
