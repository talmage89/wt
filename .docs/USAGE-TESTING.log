## 2026-02-23T21-00-00Z

Location: ~/wt-usage-tests/2026-02-23T20-00-00Z/
Tests performed:
- Single-slot configuration (slot_count=1): initialized 5-slot container, changed config to slot_count=1; `wt list` triggered reconciliation — 4 slots evicted, 1 remaining (vacant); `wt checkout main` into the vacant slot succeeded; created dirty state (modified file1.txt + untracked wip.txt); `wt checkout feature/alpha` evicted main with stash; `wt stash show main` confirmed both files captured; `wt checkout main` restored dirty state (wip.txt + modified file1.txt both present); pinned the only slot, `wt checkout feature/beta` → "All worktree slots are pinned. Unpin a worktree or increase the slot count to continue." (exit 1) — all correct per VISION §3.1, §5.1, §5.2, §11 — PASS
- Commands from container root (not inside a slot): `wt list` from container root displayed all 5 slots correctly (exit 0); `wt checkout feature/alpha` from container root succeeded, slot assigned (exit 0); `wt fetch` from container root succeeded (exit 0); `wt pin` from container root without slot arg → "Not inside a worktree slot. Specify a slot name." (exit 1) — all correct — PASS
- Pin a vacant slot: `wt pin light-aloft-small` on a vacant slot succeeded with "Pinned 'light-aloft-small' (branch: (vacant))" (exit 0); `wt list` showed pinned=true for vacant slot; `wt checkout feature/beta` used the pinned vacant slot (correct per VISION §11: "pins are irrelevant for vacant slots"); after checkout, slot retained pinned status; filled all 5 slots then checkout feature/delta — the pinned slot (light-aloft-small / feature/beta) was NOT evicted; LRU unpinned slot evicted instead — correct per VISION §11 — PASS
- Stash commands with zero stashes: `wt stash list` → "No saved stashes." (exit 0); `wt stash show feature/alpha` → "No stash found for branch 'feature/alpha'." (exit 1); `wt stash apply feature/alpha` → "No stash found for branch 'feature/alpha'." (exit 1) — all correct, clean error messages — PASS
- Init from existing repo with staged+unstaged+untracked dirty state: cloned remote, staged new file (staged-new.txt), modified tracked file (file1.txt), created untracked file (untracked.txt); `wt init` succeeded (exit 0), 5 slots created, main slot marked dirty; `git status` in main slot showed all 3 categories preserved: staged-new.txt still staged (Changes to be committed), file1.txt still unstaged-modified, untracked.txt present; `wt checkout main` from within the main slot was a no-op — no eviction, dirty state fully intact — correct per VISION §2.1 and §3.1 step 3 — PASS
Result: PASS

---

## 2026-02-23T19-30-00Z

Location: ~/wt-usage-tests/2026-02-23T19-30-00/
Tests performed:
- Post-checkout hook with non-zero exit code: created `.wt/hooks/post-checkout` that writes args to a file then `exit 1`; ran checkout via shell function (`eval "$(wt shell-init bash)"`); hook fired correctly ($1=slot path, $2=branch name), stderr output visible ("Hook running but will exit with error"), checkout succeeded with exit 0 despite hook failure; VISION §4.3 does not specify behavior on hook failure, non-blocking behavior is reasonable — PASS
- `wt stash apply` on archived stash: evicted feature/alpha (dirty), faked timestamp to 8 days ago, deleted remote branch, ran `wt fetch` — archival triggered correctly; then `wt stash apply feature/alpha` → "wt: Stash for 'feature/alpha' is archived. Use 'wt clean' to manage archived stashes." (exit 1) — correct, clear error message directing user to proper workflow — PASS
- Template source modification then re-sync: configured `[[templates]]` with source pointing to `.wt/templates/env.development`; ran `wt sync` — all 5 slots got `.env.development` with correct `{{WORKTREE_DIR}}` and `{{BRANCH_NAME}}` expansion; modified template source (VERSION=1.0→2.0, added NEW_SETTING=enabled); ran `wt sync` again — all 5 slots regenerated with new content (VERSION=2.0 and NEW_SETTING=enabled present in all) — correct per VISION §7.1 "always overwrite" — PASS
- Triple-slash branch name through full stash lifecycle: checked out `feature/deep/nested/path`, created dirty state (deep-wip.txt untracked, file1.txt modified), forced eviction via LRU manipulation + checkout main; stash metadata file encoded as `feature--deep--nested--path.toml` (correct per VISION §14); `wt stash show feature/deep/nested/path` displayed correct diff with all 3 files; re-checked out feature/deep/nested/path — stash auto-restored, deep-wip.txt and modified file1.txt present in new slot; stash cleaned up — full roundtrip correct — PASS
- All 5 slots occupied+dirty, checkout new branch: filled all 5 slots with branches, added real user dirty state (untracked wip file + modified file2.txt) to every slot plus template-generated .env.development; checkout feature/epsilon — LRU slot (heavy-wax-marten / fix/urgent) correctly evicted with stash creation; `wt stash show fix/urgent` confirmed all 3 dirty files captured (template .env.development, modified file2.txt, untracked user-wip-heavy-wax-marten.txt); feature/epsilon checked out successfully in the evicted slot — correct per VISION §3.1 step 4b (LRU eviction) and §5.1 (dirty state stashing) — PASS
Result: PASS

---

## 2026-02-23T18-00-00Z

Location: ~/wt-usage-tests/2026-02-23T18-00-00Z/
Tests performed:
- wt with no args outside a container (/tmp): displayed help/usage text with all commands listed; exit 0 — correct per VISION §8 ("If not [inside a managed container], it displays CLI help/usage")
- wt with no args inside worktree slot (non-TTY): ran `node /workspace/bin/wt.mjs` from inside bison-dawn-thaw slot; partial TUI render appeared briefly, then Ink crashed with "Error: Raw mode is not supported on the current process.stdin" plus a full Node.js stack trace; exit 1 — BUG FOUND
Result: BUG FOUND
Bug: BUG-011 — TUI crashes with unhandled Ink "Raw mode is not supported" error and full stack trace when stdin is not a TTY; should detect non-TTY and gracefully fall back to help output or a clean error message (see .docs/BUGS.md)

---

## 2026-02-23T17-30-00Z

Location: ~/wt-usage-tests/2026-02-23T17-30-00Z/
Tests performed:
- wt init from repo with existing local branches: cloned remote, created local branches (feature/alpha, feature/beta) before running `wt init`; init succeeded (exit 0), 5 slots created, 1 on main; bare repo at .wt/repo/ retained both local branches (feature/alpha, feature/beta) and all remote-tracking branches; `wt checkout feature/alpha` succeeded, slot assigned correctly — correct per VISION §2.1 (move existing repo into .wt/repo/)
- Slot count decrease with dirty worktrees: filled all 5 slots (main, feature/alpha-delta); created dirty state in 3 slots (main: modified file1.txt + untracked main-wip.txt; feature/alpha: untracked alpha-wip.txt; feature/beta: staged beta-staged.txt); decreased slot_count from 5 to 2 in config.toml; `wt list` triggered reconciliation — 3 LRU dirty slots evicted, 2 remaining (feature/gamma, feature/delta); `wt stash list` showed 3 active stashes (main, feature/alpha, feature/beta); `wt stash show` for each confirmed correct content preservation (modified, untracked, staged files all captured); slot directories removed — correct per VISION §10.1 (slot decrease evicts LRU) and §5.1 (dirty state stashed on eviction)
- Missing template source file: configured two [[templates]] entries — one with existing source (.env.development) and one with nonexistent source (nonexistent.yml); `wt sync` printed "wt: template source not found: <path>" once per slot (5 times) for the missing source; exit 0 (non-fatal); existing template generated correctly in all 5 slots with proper {{WORKTREE_DIR}} and {{BRANCH_NAME}} expansion; missing template's target NOT generated (correct skip); vacant slots got empty BRANCH_NAME — correct graceful handling
- Post-checkout hook with double-slash branch name: created .wt/hooks/post-checkout (writes $1 and $2 to file); ran `wt checkout feature/hook-test/deep` via shell function (eval'd shell-init bash); hook fired correctly with $1=slot absolute path, $2=feature/hook-test/deep (full branch name including slashes, not encoded); template .env.development also correctly expanded with BRANCH=feature/hook-test/deep — correct per VISION §4.3 and §7.2
Result: PASS

---

## 2026-02-23T16-30-00Z

Location: ~/wt-usage-tests/2026-02-23T16-30-00Z/
Tests performed:
- Branch encoding in stash operations (single slash): checked out feature/auth, created dirty state (staged.txt, file1.txt modified, auth-wip.txt untracked), evicted via checkout of other branches; `wt stash list` showed feature/auth correctly; stash metadata file encoded as feature--auth.toml; `wt stash show feature/auth` displayed all 3 files with correct diffs — correct per VISION §14 (encoding) and §5.2.1
- Branch encoding in stash operations (double slash): checked out feature/deep/nested, created dirty state (nested-wip.txt staged, README.md modified), evicted; stash metadata encoded as feature--deep--nested.toml; `wt stash show feature/deep/nested` showed both files; `printf 'y\n' | wt stash drop feature/deep/nested` succeeded, metadata file deleted — correct per VISION §14 (double slash → double --)
- Unpin and immediately evict: pinned all 5 slots; `wt checkout feature/deep/nested` → "All worktree slots are pinned. Unpin a worktree or increase the slot count to continue." (exit 1) — correct per VISION §11; unpinned wane-fox-fjord (fix/bug-123); `wt checkout feature/deep/nested` succeeded — wane-fox-fjord (the only unpinned slot) was correctly selected for eviction; fix/bug-123 evicted, feature/deep/nested checked in — correct per VISION §3.1 step 4b (LRU among unpinned)
- Multiple [shared] directories simultaneously: configured [shared] directories = [".config", ".tools"] with 2 files in .config/ and 1 file in .tools/; `wt sync` produced no errors; all 5 slots received correct symlinks for all 3 files across both directories; symlink targets resolved to correct canonical content; editing through one slot's symlink was visible through another slot's symlink (single canonical copy) — correct per VISION §6.2
- wt init in non-empty non-git directory: created directory with data.txt, ran `wt init` → "wt: Not a git repository. Use 'wt init <url>' to clone, or run from inside a git repository." (exit 1) — correct per VISION §15.1; also tested `wt init <url>` into directory with a dotfile → "wt: Directory is not empty. Use 'wt init' from inside an existing repository, or run from an empty directory." (exit 1) — correct per VISION §15.1
- Stash list with multiple active stashes: created dirty state in 3 slots (real user files, not just symlinks), triggered sequential evictions via checkout of feature/x, feature/y, feature/z; `wt stash list` correctly showed 2 active stashes (feature/auth and main) — the other evicted slots only had shared symlinks as dirty state (removed before stashing per BUG-007 fix), so no stash was created for them; `wt stash show` for both stashes displayed correct diffs with all user files — correct per VISION §5.1 and §5.2.1
Result: PASS

---

## 2026-02-23T15-00-00Z

Location: ~/wt-usage-tests/2026-02-23T15-00-00Z/
Tests performed:
- Self-eviction (checkout when current slot IS the LRU candidate): filled all 5 slots; from garnet-smooth-bur (main, the LRU), created dirty state (wip.txt + modified file1.txt), then ran `wt checkout feature/epsilon`; garnet-smooth-bur correctly evicted itself — stash created for main with both files, feature/epsilon checked out in same slot; `wt stash show main` confirmed both modified and untracked files preserved — correct per VISION §3.1 step 4b (LRU selection) and §5.1 (stash save)
- Nav file lifecycle via shell function: ran `bash -c 'eval "$(wt shell-init bash)"; wt checkout feature/beta'` with PATH including /workspace/bin; no nav file existed before checkout; after checkout, nav file consumed and deleted by shell function; cwd correctly changed to nettle-cairn-light (feature/beta slot) — correct per VISION §4.2 (nav file mechanism)
- Deeply nested shared directories: configured [shared] directories=[".config/deep/nested"]; created 2 canonical files (settings.json, env.local) at .wt/shared/.config/deep/nested/; ran wt sync; all 5 slots received correct symlinks at .config/deep/nested/{settings.json,env.local} with proper relative path depth (../../../../.wt/shared/...); symlink content resolved correctly — correct per VISION §6.2
- Drop archived stash (verify full cleanup): created stash for feature/epsilon, faked timestamp to 8 days ago, deleted remote branch, ran `wt fetch` — archival triggered; patch file at .wt/stashes/archive/feature--epsilon.patch + metadata at .wt/stashes/feature--epsilon.toml both present with status=archived; ran `printf 'y\n' | wt stash drop feature/epsilon`; both patch file AND metadata TOML deleted; stash list empty; archive dir empty — correct per VISION §5.5
- Multiple stash accumulation + sequential restore: evicted 3 branches (beta, zeta, main) with unique dirty state; each got independent stash with correct content per `wt stash show`; re-checked out all 3 in sequence; beta restored beta-unique.txt + modified file2.txt ✓; zeta restored zeta-work.txt + modified file2.txt ✓; main restored wip.txt + modified file1.txt ✓; all 3 stashes cleaned up after successful restore; 2 new stashes created for alpha and gamma (evicted during restoration) — correct per VISION §5.2 (restore) and §5.1 (save on eviction)
Result: PASS

---

## 2026-02-24T14-00-00Z

Location: ~/wt-usage-tests/2026-02-24T14-00-00Z/
Tests performed:
- wt fetch: ran `wt fetch` on fresh container; printed "Fetched latest from remote." exit 0; no spurious output — correct per VISION §12
- wt stash show [branch]: created dirty state (staged.txt + dirty.txt as untracked) in feature-alpha slot, forced eviction via multiple checkouts; `wt stash show feature-alpha` output a clean unified diff showing both files with correct content — correct per VISION §5.2.1
- wt unpin without slot argument (current worktree): pinned hawk-plain-delta (main) via `wt pin hawk-plain-delta`; cd into hawk-plain-delta slot; ran `wt unpin` with no args; correctly detected current slot and unpinned with message "Unpinned 'hawk-plain-delta' (branch: main). It can now be evicted via LRU." exit 0; wt list confirmed pinned=false — correct per VISION §11
- wt clean with no archived stashes: ran `wt clean` on container with no stashes; printed "No archived stashes to clean." exit 0; no crash or hang — correct graceful empty-state handling
- wt checkout nonexistent branch (no remote): ran `wt checkout totally-nonexistent-branch-xyz`; git error passed through verbatim ("error: pathspec 'totally-nonexistent-branch-xyz' did not match any file(s) known to git"); exit 1; the target slot (hawk-plain-delta) was correctly left in detached HEAD state and marked vacant; re-running `wt checkout main` succeeded and recovered the slot — correct behavior per VISION §15.3 and §3.1 error handling
- wt stash drop with piped input: `printf 'n\n' | wt stash drop feature-alpha` → "Aborted." exit 0; `printf 'y\n' | wt stash drop feature-alpha` → "Stash dropped for 'feature-alpha'." exit 0; stash list confirmed empty — correct
- wt stash drop with stdin=/dev/null (non-interactive): `wt stash drop main </dev/null` → printed prompt, then Node.js "Warning: Detected unsettled top-level await" + exit code 13; stash was NOT dropped (safe), but exit code and warning are wrong — BUG FOUND
Result: BUG FOUND
Bug: BUG-010 — `wt stash drop` crashes with exit 13 and Node.js warning when stdin is non-interactive (no data); `promptConfirm()` does not handle stdin close/EOF event (see .docs/BUGS.md)

---

## 2026-02-24T12-00-00Z

Location: ~/wt-usage-tests/2026-02-24T12-00-00Z/
Tests performed:
- wt init from repo with dirty state (staged tracked file committed, unstaged modification, untracked file): init succeeded (exit 0); dirty state preserved in the main slot (lime-muted-close); `wt list` showed slot as "dirty"; 4 vacant slots created correctly — correct behavior per VISION §2
- Shared symlink removed when checking out to a branch that git-tracks the shared file: configured [shared] directories=[".config"], created .wt/shared/.config/app.json, ran wt sync (all 5 slots got symlinks including vacant ones); then `wt checkout feature/tracked-config` (which has .config/app.json tracked in git): checkout FAILED — "error: The following untracked working tree files would be overwritten by checkout: .config/app.json" — BUG FOUND
Result: BUG FOUND
Bug: BUG-009 — `wt checkout` fails when target slot has a shared symlink that the target branch git-tracks; symlinks not removed from target slot before git checkout (see .docs/BUGS.md)

---

## 2026-02-24T11-00-00Z

Location: ~/wt-usage-tests/2026-02-24T11-00-00Z/
Tests performed:
- wt ls alias: produced identical output to wt list (5 slots, correct branch/status/pinned/last-used columns) — correct alias per VISION §9
- wt co alias: successfully checked out feature/alpha via `wt co feature/alpha`; slot assigned, wt ls confirmed — correct alias per VISION §9
- Non-executable .wt/hooks/post-checkout: created hook with chmod -x; ran wt co feature/beta; hook NOT executed (no /tmp/hook-fired.txt created), checkout succeeded exit 0 — correct per VISION §4.3 "if it exists and is executable"; made hook executable and confirmed it fires via shell function (hook writes /tmp/hook-fired.txt)
- wt stash apply with no branch argument (defaults to current branch): created dirty state in feature/alpha slot (modified + untracked files), evicted via checkout of new branch feature/zeta (stash created), re-checked out feature/alpha with --no-restore (stash preserved), then ran `wt stash apply` from inside the feature/alpha slot with NO arguments; correctly defaulted to current branch feature/alpha; applied stash and cleaned up; alpha.txt modified + untracked.txt + untracked2.txt all restored — correct per VISION §5.2.1 "defaults to the current branch"
- wt checkout with unreachable remote: set origin to file:///nonexistent/path/repo; ran wt co feature/epsilon (already in slot): git fetch error passed through verbatim ("fatal: '/nonexistent/path/repo' does not appear to be a git repository"), checkout continued, exit 0 — correct non-fatal fetch per checkout code; ran wt co feature/beta (not in slot but exists locally): fetch error printed verbatim, checkout succeeded, exit 0 — correct per VISION §15.3 (git errors pass through)
- wt sync with no [shared] section / empty directories: removed [shared] section entirely from config.toml; ran wt sync — silent exit 0; restored config with [shared] directories=[] (empty); wt sync again — silent exit 0; wt ls worked correctly — correct no-op handling per VISION §6.4
Result: PASS

---

## 2026-02-24T10-00-00Z

Location: ~/wt-usage-tests/2026-02-24T10-00-00/
Tests performed:
- Stash apply after branch rebase (conflict scenario): saved stash at base 7ac0cb1 (shared-file.txt = "base content"), force-updated local branch tip to fe86946 (shared-file.txt = "rebased content..."), re-checked out feature/rebase-test; wt detected conflict and printed "wt: Stash for feature/rebase-test produced conflicts. Resolve manually." (exit 0); shared-file.txt contained correct conflict markers (<<<<<<< Updated upstream / ======= / >>>>>>> Stashed changes); stash retained in stash list at status=active — correct per VISION §5.2
- Real file migration via wt sync: configured [shared] directories=[".config"], created real (non-symlink) .config/app.json in pool-wren-husk slot with content {"key":"migrated-value"}; ran wt sync; canonical file moved to .wt/shared/.config/app.json with original content preserved; pool-wren-husk slot got symlink -> ../../.wt/shared/.config/app.json; all 4 other slots also got correct symlinks — correct per VISION §6.2 "move it to .wt/shared/ and replace it with a symlink"
- Broken symlink cleanup via wt sync: deleted canonical .wt/shared/.config/app.json; verified all 5 slots had broken symlinks; ran wt sync; all 5 broken symlinks removed cleanly (no errors, no residual files) — correct per VISION §6.2 "If a symlink is broken (target deleted), remove it"
- Manual git worktree add in container: ran `git worktree add manual-slot feature/branch-a` directly in the bare repo; wt list showed only the 5 managed slots (ignored manual-slot), no errors, exit 0 — correct graceful handling; wt does not manage externally-added worktrees
Result: PASS

---

## 2026-02-24T09-00-00Z

Location: ~/wt-usage-tests/2026-02-24T09-00-00/
Tests performed:
- BUG-007 fix verified: shared symlinks excluded from stash on eviction; stash for feature/alpha contained only user files (alpha.txt, my-untracked.txt) — no .config/app.json symlink; stash applied cleanly with no "already exists, no checkout" error — correct
- BUG-008 fix verified: wt fetch archival produced clean output — "Warning: zstd not found. Archived stash stored uncompressed." and "Archived 1 stash(es): feature/zeta" with NO "fatal: this operation must be run in a work tree" — correct
- wt clean with actual archived stash: displayed archived stash list with branch, age, size; prompts for selection and confirmation correctly; actual deletion not confirmed (requires TTY for two sequential readline prompts — non-TTY piped input insufficient); stash archive file and metadata confirmed present before and after TTY-incomplete test
- wt stash drop on archived stash: prompt "Drop stash for 'feature/zeta'? This cannot be undone. [y/N]" appeared correctly; TTY required for confirmation
- Template {{BRANCH_NAME}} on vacant (detached) slots: wt sync generated slot-info.txt in all 5 slots; vacant slots (green-palm-talon, forest-bent-prism) correctly got branch= (empty string), not "undefined" or error; occupied slots got correct branch names — correct per templates.ts expandTemplate (slot.branch ?? "")
- Sequential eviction of all slots: evicted 3 occupied slots in sequence by checkout of lambda, mu, nu; first used 2 vacant slots, then evicted LRU occupied slot (feature/theta); 3 active stash metadata files accumulated correctly (feature/alpha, feature/eta, feature/theta) alongside existing archived feature/zeta; each stash contained correct user dirty state; no shared-symlink contamination in any stash
- Confirmed: wt clean prompts work interactively (correct behavior); piped input fails at second readline due to Node.js readline interface destroy/create pattern — expected TTY-only behavior, not a wt bug
Result: PASS

---

## 2026-02-23T24-00-00Z

Location: ~/wt-usage-tests/2026-02-23T24-00-00/
Tests performed:
- wt init twice (from inside already-initialized container): "Directory is not empty. Use 'wt init' from inside an existing repository, or run from an empty directory." (exit 1) — acceptable behavior
- Delete a slot directory (ember-quartz-trunk), run wt list: wt silently reconciled — recreated a new vacant slot (glade-spruce-reed) to maintain slot count of 5; "Preparing worktree" message printed (expected git output); list showed 5 slots correctly — correct graceful handling per VISION §3.2
- Corrupt state.toml (invalid TOML), run wt list: "Warning: .wt/state.toml is corrupted. Regenerating from git state." (stderr), state recovered from git, list showed correct slots with epoch timestamps (expected since real timestamps lost) — correct
- Stash archival: faked stash last_used_at to 8 days ago, deleted feature/alpha from remote, ran wt fetch; archival triggered; patch file written to .wt/stashes/archive/feature--alpha.patch; stash metadata updated to status=archived — correct. However: "fatal: this operation must be run in a work tree" printed to stderr before archival succeeded — BUG FOUND
Result: BUG FOUND
Bug: BUG-008 — archiveStash leaks `fatal: this operation must be run in a work tree` from git stash show called against bare repo (see .docs/BUGS.md)

---

## 2026-02-23T22:00:00Z

Location: ~/wt-usage-tests/2026-02-23T22-00-00/
Tests performed:
- zsh shell-init output: syntactically valid wt() function, uses `command wt "$@"` (BUG-003 fix present), reads /tmp/wt-nav-$$ (matching process.ppid in binary), post-checkout hook integration — correct
- fish shell-init output: syntactically valid fish function, uses `command wt $argv`, reads /tmp/wt-nav-$fish_pid — correct; zsh/fish not available in test env, static analysis only
- Non-existent branch checkout: `wt checkout nonexistent-branch-xyz` → git error passes through verbatim + "wt: Command failed with exit code 1" (exit 1) — correct per VISION §15.3
- git-tracked file wins over shared symlink: configured [shared] directories = [".config"], but branch feature/tracked-config has .config/app.json git-tracked; ran wt checkout feature/tracked-config; warning "wt: Skipping symlink for .config/app.json: file is tracked by git in branch feature/tracked-config." printed; slot has regular file (git content), NOT a symlink — correct per VISION §6.3
- Non-tracked slots get the symlink: ran wt sync; main slot got lrwxrwxrwx .config/app.json -> ../../.wt/shared/.config/app.json — correct
- wt clean with no archived stashes: "No archived stashes to clean." (exit 0) — correct
- wt pin from inside slot (no args): pinned correctly, "Pinned 'narrow-ardent-snipe' (branch: main). It will not be evicted." — correct
- wt unpin from inside slot (no args): unpinned correctly — correct
- wt pin from outside container (/tmp): "wt: Not inside a wt-managed container." (exit 1) — correct
- wt pin from container root (no slot arg): "wt: Not inside a worktree slot. Specify a slot name." (exit 1) — correct
- wt checkout --no-restore: slot checked out, auto-restore skipped, stash retained in stash list — correct (BUG-004 fix confirmed again)
- wt stash apply with tracked-file merge conflict AND shared-symlink collision: applied stash for feature/conflict-test (stash from old commit, branch at new commit); got both: (a) merge conflict markers in shared-file.txt, and (b) "already exists, no checkout" error for .config/app.json shared symlink — BUG FOUND
Result: BUG FOUND
Bug: BUG-007 — stash apply fails for shared symlinks because wt sync creates them before stash apply, causing "already exists, no checkout" error; shared symlinks should not be included in stashes (see .docs/BUGS.md)

---

## 2026-02-23T20:00:00Z

Location: ~/wt-usage-tests/2026-02-23T20-00-00/
Tests performed:
- wt init from URL (bare clone) into fresh directory: 5 slots created, 1 on main, 4 vacant — correct
- Post-checkout hook (.wt/hooks/post-checkout) with shell integration: created executable hook, ran `wt checkout feature/api` via eval'd shell function; hook called with correct args (worktree path = slot dir, branch = feature/api) — correct per VISION §4.3
- Post-checkout hook across multiple checkouts: verified hook fires on each checkout with slot-specific worktree path and branch name — correct
- Shared symlink conflict check (BUG-005 regression): configured [shared] directories = [".claude"], created .wt/shared/.claude/CLAUDE.md, ran wt sync — "error: pathspec '.claude/CLAUDE.md' did not match any file(s) known to git" still printed 5 times (once per slot)
- Root cause: dist/chunk-EHB43JQC.js still has `stdio: ["ignore", "pipe", "inherit"]` in isTracked; pnpm build was NOT run after the BUG-005 source fix was committed at 07:45:59
Result: BUG FOUND
Bug: BUG-006 — BUG-005 fix not applied to binary; dist not rebuilt after source change (see .docs/BUGS.md)

---

## 2026-02-23T16:00:00Z

Location: ~/wt-usage-tests/2026-02-23T16-00-00/
Tests performed:
- wt init from existing repo (no URL): repo moved to .wt/repo/, 5 slots created, 1 slot on main, 4 vacant — correct
- Slot count increase: changed slot_count from 5 to 7 in config.toml, ran wt list; 2 new vacant slots created automatically — correct
- Slot count decrease: changed slot_count from 7 to 4, ran wt list; 3 LRU slots removed (directories and git worktree entries cleaned up) — correct
- Slot count decrease below pinned count: pinned all 4 remaining slots, set slot_count=2, ran wt list → "wt: Cannot reduce slot count to 2: 4 worktrees are pinned. Unpin worktrees first or choose a higher count." (exit 1) — correct per VISION §10.1
- Checkout branch already in a slot: wt checkout main (already in slot widgeon-husk-flat) → exit 0, nav file pointed to correct slot, no eviction — correct per VISION §3.1 step 3
- Shared symlinks via wt sync: configured [shared] directories = [".claude"], created canonical files in .wt/shared/.claude/, ran wt sync; all 5 slots got correct symlinks pointing to canonical files — correct
- Shared symlinks on checkout: wt checkout feature/slot-count ran symlink reconciliation (step 9), symlinks created correctly in the target slot — correct
- BUG FOUND: wt sync and wt checkout print raw git error output "error: pathspec '.claude/CLAUDE.md' did not match any file(s) known to git" for every untracked shared file in every slot during the git-tracked conflict check
Result: BUG FOUND
Bug: BUG-005 — internal git stderr leaked during shared symlink conflict check (see .docs/BUGS.md)

---

## 2026-02-23T14:00:00Z

Location: ~/wt-usage-tests/2026-02-23T14-00-00/
Tests performed:
- Discovered: BUG-004 source fix was committed but dist/ was never rebuilt (pnpm build not run). Binary still had old `.option("no-restore")` code. Fixed by running `pnpm build` at start of session.
- --no-restore flag (BUG-004 fix verified post-rebuild): `wt checkout --no-restore feature/auth` succeeded (exit 0), worktree clean, stash preserved in `wt stash list` — correct
- wt stash apply (manual): `wt stash apply feature/auth` restored staged, unstaged, and untracked files; stash cleaned up on success; "Stash applied and cleaned up for 'feature/auth'." — correct (staged state becomes unstaged after apply, expected behavior of `git stash apply` without --index per VISION §5.2)
- wt stash apply on branch not in any slot: `wt stash apply feature/evict-trigger` (stash exists, branch evicted) → "wt: Branch 'feature/evict-trigger' is not checked out in any slot. Run 'wt checkout feature/evict-trigger' first." (exit 1) — correct
- wt stash apply with no stash: `wt stash apply feature/api` → "wt: No stash found for branch 'feature/api'." (exit 1) — correct
- wt fetch: ran wt fetch after adding upstream commit to feature/api; output showed "Fetched latest from remote." and remote tracking ref in bare repo updated to new commit — correct
- Template files via wt sync: configured [[templates]] in config.toml with source "templates/.env.development" (uses {{WORKTREE_DIR}} and {{BRANCH_NAME}}), ran `wt sync`; all 5 slots got correct .env.development with slot-specific WORKTREE_DIR and branch-specific BRANCH_NAME values — correct
- Template regeneration on wt checkout: checked out feature/evict-trigger into spit-lupine-cool; .env.development regenerated with BRANCH=feature/evict-trigger — correct
- Observation: generated template files (.env.development) are untracked, causing all slots to show as "dirty" in wt list — expected behavior per VISION §7.3 (user must gitignore generated files)
- LRU eviction correctness spot-checked: verified via state.toml timestamps that LRU selection correctly chose oldest slot
Result: PASS

---

## 2026-02-23T12:00:00Z

Location: ~/wt-usage-tests/2026-02-23T12-00-00/
Tests performed:
- BUG-003 fix verified: eval "$(wt shell-init bash)" then wt checkout — cwd changed correctly to slot directory, no segfault
- wt pin (by name) and wt unpin: pinned all 5 slots including a vacant one; verified pinned=true in wt list; unpinned one slot successfully
- All-slots-pinned error: with all 5 slots filled and pinned, wt checkout of new branch → "All worktree slots are pinned. Unpin a worktree or increase the slot count to continue." (exit 1) — correct per VISION.md §11
- LRU eviction with dirty state (staged + unstaged + untracked): all three file types saved in stash and shown in wt stash show — BUG-001 fix confirmed working
- wt stash list: shows branch, age, status (active), base commit correctly
- wt stash show: displays full diff of stash including untracked files
- wt stash drop: prompts for confirmation, deletes stash, wt stash list shows "No saved stashes"
- wt stash show on branch with no stash: "wt: No stash found for branch 'feature/api'." (exit 1) — correct
- Reconciliation: direct git checkout inside a slot (bypassing wt), then wt list silently updated state to show new branch — correct per VISION.md §3.2
- --no-restore flag: wt checkout --no-restore <branch> → "Unknown argument: restore" (exit 1) — BUG FOUND
Result: BUG FOUND
Bug: BUG-004 — `--no-restore` flag rejected by yargs strict mode due to boolean-negation conflict (see .docs/BUGS.md)

---

## 2026-02-23T09:00:00Z

Location: ~/wt-usage-tests/2026-02-23T09-00-00/
Tests performed:
- wt shell-init bash: output defines a syntactically valid wt() function (verified with `type wt`)
- wt checkout feature/slash-branch (branch with `/` in name): succeeded, slot assigned, wt list correct
- shell integration cwd change: eval'd shell function, then called `wt checkout` — bash segfaulted (exit 139)
- Root cause confirmed: `command -v wt` inside the shell function returns `wt` (the function name, not the binary path) because the shell function shadows the binary; `"$wt_bin" "$@"` thus calls the function recursively causing stack overflow
Result: BUG FOUND
Bug: BUG-003 — shell function infinite recursion → segfault because `command -v wt` returns function name instead of binary path (see .docs/BUGS.md)

---

## 2026-02-23T08:00:00Z

Location: ~/wt-usage-tests/2026-02-23T08-00-00/
Tests performed:
- wt init from local file:// URL (bare clone) — succeeded
- wt list from inside container: showed 1 active slot (main) + 4 vacant slots correctly
- Observed: "fatal: ref HEAD is not a symbolic ref" printed 4 times for vacant (detached HEAD) slots during reconciliation
- Bug confirmed: currentBranch() in reconcile uses stdio inherit for stderr, leaking internal git errors to terminal
Result: BUG FOUND
Bug: BUG-002 — "fatal: ref HEAD is not a symbolic ref" printed for every vacant slot on every wt command (see .docs/BUGS.md)

---

## 2026-02-23T07:05:00Z

Location: ~/wt-usage-tests/2026-02-23T10-00-00/
Tests performed:
- wt init from local repo URL (bare clone path)
- wt checkout of remote-only branches (feature/auth, feature/api, fix/bug-123, feature/db)
- wt list output format and slot assignment verification
- Stash save on LRU eviction: slot with staged + unstaged + untracked changes evicted
- Stash restore on branch re-checkout: verified staged/unstaged restored, untracked NOT restored
- git stash create --include-untracked confirmed to omit untracked files (2-parent only)
- git stash push --include-untracked confirmed to include untracked files (3-parent)
Result: BUG FOUND
Bug: BUG-001 — untracked files silently lost during slot eviction due to git stash create not supporting --include-untracked (see .docs/BUGS.md)
